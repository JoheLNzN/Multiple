<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="css/jquery.datepick.css" rel="stylesheet">
    <link rel="stylesheet" href="css/all.css">
</head>

<body>

    <div class="c-mobile">
        <div id="datepicker"></div>
    </div>
    <!--c-mobile-->

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/jquery.plugin.min.js"></script>
    <script src="js/jquery.datepick.js"></script>

    <script type="text/javascript">

        function getJSONFromDBFake() {
            return {
                "Project": {
                    "StartDate": "04/04/2020",
                    "EndDate": "28/04/2020",
                    "Color": "#6ab04c",
                    "Event": [
                        {
                            "Title": "Title One",
                            "Details": "1. Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                            "Color": "red"
                        },
                        {
                            "Title": "Title Two",
                            "Details": "2. Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                            "Color": "#f9ca24"
                        },
                        {
                            "Title": "Title Three",
                            "Details": "3. Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                            "Color": "#be2edd"
                        },
                        {
                            "Title": "Title Four",
                            "Details": "4. Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                            "Color": "purple"
                        }
                    ]
                }
            }
        }

        function getRangeDates(startDate, endDate) {
            var range = [];
            while (startDate <= endDate) {
                range.push(new Date(startDate));
                startDate.setDate(startDate.getDate() + 1);
            }
            return range;
        };

    </script>

    <script type="text/javascript">

        /* Configurables */
        var _myObject = getJSONFromDBFake();

        /* Estáticos */
        var _dtp = '#datepicker';
        var _daysSelected = [];

        $(_dtp).datepick({
            firstDay: 1,
            monthNames: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Setiembre", "Octubre", "Noviembre", "Diciembre"],
            monthNamesShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Set", "Oct", "Nov", "Dic"],
            dayNames: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"],
            dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sáb"],
            dayNamesMin: ["D", "L", "M", "X", "J", "V", "S"],
            prevText: "",
            nextText: "",
            todayText: "Hoy",
            prevStatus: "",
            nextStatus: "",
            todayStatus: "",
            monthStatus: "",
            yearStatus: "",
            currentStatus: "",
            dayStatus: "",
            multiSelect: 999,
            dateFormat: "dd/MM/yyyy",
            onSelect: function (dates) {
                configDatePicker(_myObject);
            }
        });


        /**********************************************************
         ****************    BEGIN  - Configuration   *************/

        var sd = _myObject.Project.StartDate.split("/");
        var ed = _myObject.Project.EndDate.split("/");

        var startDate = new Date(sd[2], sd[1] - 1, sd[0]);
        var endDate = new Date(ed[2], ed[1] - 1, ed[0]);

        $(_dtp).datepick('setDate', getRangeDates(startDate, endDate));

        /* Method */
        function configDatePicker(config) {
            debugger;

            if (config == null || config == undefined) {
                console.log('El objeto es nulo o no ha sido definido');
                return;
            }

            var _theme, _color, _title, _details;

            if (config.Project != undefined) {
                _theme = config.Project.Color == undefined ? "#417AFF" : config.Project.Color;

                if(config.Project.Event != undefined){

                    switch (config.Project.Event.length) {
                        case 0: {
                            console.log('No hay eventos :(')
                            break;
                        }
                        case 1: {
                            _color = config.Project.Event[0].Color;
                            break;
                        }
                        case 2: {
                            _color = config.Project.Event[0].Color;
                            _title = config.Project.Event[1].Color;
                            break;
                        }
                        default: {
                            _color = config.Project.Event[0].Color;
                            _title = config.Project.Event[1].Color;
                            _details = config.Project.Event[2].Color;
                            break;
                        }
                    }
                }
            }
            else {
                _theme = '#417AFF';
                _color = 'red';
                _title = 'white';
                _details = 'red';
            }

            var $dtp = $(document).find(_dtp);

            $dtp.find('.datepick-today').css('background-color', '#A3CB38');

            $dtp.find('a.datepick-cmd-today').css('background-color', _theme);
            $dtp.find('.datepick-month-header input').css('color', _theme);
            $dtp.find('.datepick-month-header select').css('color', _theme);
            $dtp.find('a.datepick-selected').css('background-color', _theme);

            customSnakeDays(_myObject);

            $dtp.find('.datepick .li-1').css('background-color', _color);
            $dtp.find('.datepick .li-2').css('background-color', _title);
            $dtp.find('.datepick .li-3').css('background-color', _details);   
        }

        /* Event */
        $(_dtp).on('click', function (e) {
            e.preventDefault();
            configDatePicker(_myObject);
        });

        $(_dtp).on('click', 'tbody td a', function (e) {
            e.preventDefault();
            alert('click');
        });

        function customSnakeDays(config) {
            var $dtp = $(document).find('#datepicker');
            var $tbody = $dtp.find('tbody');
            var $rows = $dtp.find('tbody tr');

            $rows.each(function (indexRow, itemRow) {
                var $row = $(itemRow);
                var $tds = $row.find('td');

                $tds.each(function (indexTd, itemTd) {

                    /* 0 to 6 */
                    var $currentIndex = indexTd;
                    var $prevIndex = indexTd - 1;
                    var $nextIndex = indexTd + 1;

                    /* Add customs */

                    var $ulHTML = '<ul>';

                    if (config.Project.Event != undefined) {

                        switch (config.Project.Event.length) {
                            case 0: {
                                $ulHTML = "";
                                break;
                            }
                            case 1: {
                                $ulHTML += "<li class='li-1'></li>";
                                break;
                            }
                            case 2: {
                                $ulHTML += "<li class='li-1'></li><li class='li-2'></li>";
                                break;
                            }
                            default: {
                                $ulHTML += "<li class='li-1'></li><li class='li-2'></li><li class='li-3'></li>";
                                break;
                            }
                        }

                        if ($ulHTML == "") {
                            console.log('No hay eventos');
                        } else {
                            $ulHTML += "</ul>";

                            if (dayIsSelected($row, $currentIndex)) {
                                $row.find('td').eq($currentIndex).find('ul').remove();
                                $row.find('td').eq($currentIndex).append($ulHTML);
                            }
                        }
                    }

                    if (!dayIsSelected($row, $prevIndex) &&
                        !dayIsSelected($row, $nextIndex)) {
                        return;
                    }

                    //Prev td
                    if ($prevIndex >= 0) {

                        //Has prev and next item
                        if (dayIsSelected($row, $prevIndex) &&
                            dayIsSelected($row, $nextIndex)) {
                            $row.find('td').eq($currentIndex).removeClass().addClass('isSnake');
                        }

                        if (!dayIsSelected($row, $nextIndex)) {
                            $row.find('td').eq($currentIndex).removeClass().addClass('isSnake-last');
                        }

                        if (!dayIsSelected($row, $prevIndex)) {
                            $row.find('td').eq($currentIndex).removeClass().addClass('isSnake-first');
                        }
                    }
                    else {
                        /* current = 0, prev = -1 */
                        if (dayIsSelected($row, $nextIndex))
                            $row.find('td').eq($currentIndex).removeClass().addClass('isSnake-first');
                    }

                });
            });
        }

        function dayIsSelected($row, $colIndex) {
            return $row.find('td').eq($colIndex).find('a').hasClass('datepick-selected');
        }

        configDatePicker(_myObject);

    </script>

</body>

</html>