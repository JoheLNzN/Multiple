var _myProjects=getJSONFromDBFake(),_defaultConfig={ThemeBackColor:"#4169e1",ThemeForeColor:"#fff",DefaultLanguage:"pt-BR"};function GetLanguage(e){return languages.filter((function(t){return t.lang==e}))[0]}var _language=GetLanguage(_defaultConfig.DefaultLanguage);null==_language&&(_language=GetLanguage("es-PE"));var _dtp="#datepicker";function GetRangeDates(e,t){for(var n=e.split("/"),a=t.split("/"),d=new Date(n[2],n[1]-1,n[0]),s=new Date(a[2],a[1]-1,a[0]),o=[];d<=s;)o.push(new Date(d)),d.setDate(d.getDate()+1);return o}function GetAllDatesByProjects(e){if(null==e||null==e)return console.log("GetAllDatesByProjects(Projects) | Projects is undefined or null."),void console.log("Projects : "+e);var t=[];$.each(e,(function(e,n){for(var a=GetRangeDates(n.Project.StartDate,n.Project.EndDate),d=0;d<a.length;d++)t.push(a[d])})),$(_dtp).datepick("setDate",t)}function HexToRgbA(e,t){var n;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3==(n=e.substring(1).split("")).length&&(n=[n[0],n[0],n[1],n[1],n[2],n[2]]),"rgba("+[(n="0x"+n.join(""))>>16&255,n>>8&255,255&n].join(",")+", "+t+")";throw new Error("Bad Hex")}function ConfigDatePicker(e){if(null==e||null==e)return console.log("ConfigDatePicker(Projects) | Projects is undefined or null."),void console.log("Projects : "+e);var t;CustomSnakeDays(_myProjects);var n=$(document).find(_dtp);$.each(e,(function(e,a){t=a.Project.Color;for(var d=GetRangeDates(a.Project.StartDate,a.Project.EndDate),s=0;s<d.length;s++){var o=d[s];o.setHours(12,0,0);var i=o.getTime();n.find("tbody tr td a.dp"+i).css("background-color",t),n.find("tbody span.side-a-last.dp"+i).css("background-color",HexToRgbA(t,".15")),n.find("tbody span.side-a-first.dp"+i).css("background-color",HexToRgbA(t,".15")),n.find("tbody span.side-a.dp"+i).css("background-color",HexToRgbA(t,".15"))}})),$("a.datepick-cmd-today").css({"background-color":_defaultConfig.ThemeBackColor,color:_defaultConfig.ThemeForeColor}),$("div.c-date-selected").css({"background-color":_defaultConfig.ThemeBackColor,color:_defaultConfig.ThemeForeColor}),CreateNoSelectedDateHTML(),$("div.no-select-date p").css("color",_defaultConfig.ThemeBackColor),$("div.no-events p").css("color",_defaultConfig.ThemeBackColor),$("div.datepick-month-header").css("color",_defaultConfig.ThemeBackColor),$(".datepick-month-year").css("color",_defaultConfig.ThemeBackColor)}function CustomSnakeDays(e){if(null==e||null==e)return console.log("customSnakeDays(Projects) | Projects is undefined or null."),void console.log("Projects : "+e);$(document).find(_dtp).find("tbody tr").each((function(t,n){var a=$(n);a.find("td").each((function(t,n){var d=t,s=t-1,o=t+1;if(0!=a.find("td").eq(d).find("a").length){var i='<ul class="dp'+(r=GetTimeFromElementA(a.find("td").eq(d).find("a")))+'"></ul>';a.find("td").eq(d).find("ul").remove(),a.find("td").eq(d).append(i)}if($.each(e,(function(e,n){n.Project.Color,$.each(n.Project.Event,(function(e,n){a.find("td").eq(t);var s=n.StartDate,o=n.EndDate;if(null!=s&&null!=o)for(var i=GetRangeDates(s,o),l=0;l<i.length;l++){var r=i[l];r.setHours(12,0,0);var c=r.getTime();if(0!=a.find("td").eq(d).find("a").length){var f=a.find("td").eq(d).find("ul.dp"+c+" li").length;if(f<3){var u="<li class='dp"+c+"' style='background-color: "+n.Color+"'></li>";a.find("td").eq(d).find("ul.dp"+c).append(u)}if(f>2)if(0==a.find("td").eq(d).find("a").find("span.hasMoreEvents").length){a.find("td").eq(d).find("a").append("<span class='hasMoreEvents'></span>")}}}}))})),DayIsSelected(a,s)||DayIsSelected(a,o))if(s>=0){if(DayIsSelected(a,s)&&DayIsSelected(a,o)){a.find("td").eq(d).removeClass().addClass("isSnake");var l="<span class='side-a dp"+(r=GetTimeFromElementA(a.find("td").eq(d).find("a")))+"'></span>";a.find("td").eq(d).find("span.side-a.dp"+r).remove(),a.find("td").eq(d).append(l)}if(!DayIsSelected(a,o)&&(a.find("td").eq(d).removeClass().addClass("isSnake-last"),a.find("td").eq(d).has("a.datepick-selected").length>0)){l="<span class='side-a-last dp"+(r=GetTimeFromElementA(a.find("td").eq(d).find("a")))+"'></span>";a.find("td").eq(d).find("span.side-a-last.dp"+r).remove(),a.find("td").eq(d).append(l)}if(!DayIsSelected(a,s)&&(a.find("td").eq(d).removeClass().addClass("isSnake-first"),a.find("td").eq(d).has("a.datepick-selected").length>0)){l="<span class='side-a-first dp"+(r=GetTimeFromElementA(a.find("td").eq(d).find("a")))+"'></span>";a.find("td").eq(d).find("span.side-a-first.dp"+r).remove(),a.find("td").eq(d).append(l)}}else if(DayIsSelected(a,o)&&(a.find("td").eq(d).removeClass().addClass("isSnake-first"),a.find("td").eq(d).has("a.datepick-selected").length>0)){var r;l="<span class='side-a-first dp"+(r=GetTimeFromElementA(a.find("td").eq(d).find("a.datepick-selected")))+"'></span>";a.find("td").eq(d).find("span.side-a-first.dp"+r).remove(),a.find("td").eq(d).append(l)}}))}))}function DayIsSelected(e,t){return e.find("td").eq(t).find("a").hasClass("datepick-selected")}function ChangeSizeDay(){var e=$(_dtp).find("table thead tr:first th:first").width();$(_dtp).find("table tbody tr td").css("height",e+"px")}function ShowListEventsByDaySelected(e){if(($.each(_myProjects,(function(t,n){$.each(n.Project.Event,(function(t,n){var a=n.StartDate,d=n.EndDate;if(null!=a&&null!=d)for(var s=GetRangeDates(a,d),o=0;o<s.length;o++)if(TransformDateToDDMMYYY(e)==TransformDateToDDMMYYY(s[o])){var i="<div class='event' style='background-color: "+n.Color+"'><span class='event-title'>"+n.Title+"</span> <p class='event-details'>"+n.Details+"</p></div>";$("div.c-events-inner").append(i)}}))})),0==$("div.c-events-inner").find("div.event").length)&&0==$("div.c-events-inner").find("div.no-events").length){var t="<div class='no-events'><p>"+_language.values.NoEventsForSelectedDay+"</p></div>";$("div.c-events-inner").append(t)}}function CreateEventsInnerHTML(){0!=$("div.c-events").find(".c-events-inner").length&&$("div.c-events").empty();$("div.c-events").append("<div class='c-date-selected'><p></p></div>");$("div.c-events").append("<div class='c-events-inner'></div>")}function GetDateInTextFormatPE(e){return["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][e.getDay()]+", "+(e.getDate()<10?"0"+e.getDate():e.getDate())+" de "+["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Setiembre","Octubre","Noviembre","Diciembre"][e.getMonth()]+" de "+e.getFullYear()}function GetTimeFromElementA(e){var t=$(e).prop("class").split(" ")[0];return-1==t.indexOf("dp")?(console.log("GetTimeFromElementA(ElementA) | No se econtró la clase [dp###################]"),null):t.substring(2)}function TransformDateToDDMMYYY(e){if(null!=e&&null!=e)return(e.getDate()<10?"0"+e.getDate():e.getDate())+"/"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/"+e.getFullYear()}function ClearEvents(){0==$(_dtp).find("a.current-date-select").length&&$("div.c-events").empty()}function CreateNoSelectedDateHTML(){var e="<div class='no-select-date'><p>"+_language.values.NoSelectedDate+"</p></div>",t=$(_dtp).find("a.current-date-select").length,n=$("div.c-events").find(".no-select-date").length;0==t?0==n&&$("div.c-events").append(e):0!=n&&$("div.c-events").find(".no-select-date").remove()}function AutomaticConfigPicker(){var e=setInterval((function(){$(_dtp).trigger("click")}),100);setTimeout((function(){clearInterval(e)}),1e3)}$(_dtp).datepick({monthNames:_language.values.monthNames,monthNamesShort:_language.values.monthNamesShort,dayNames:_language.values.dayNames,dayNamesShort:_language.values.dayNamesShort,dayNamesMin:_language.values.dayNamesMin,todayText:_language.values.todayText,firstDay:_language.values.firstDay,prevText:"",nextText:"",prevStatus:"",nextStatus:"",todayStatus:"",monthStatus:"",yearStatus:"",currentStatus:"",dayStatus:"",multiSelect:999,onChangeMonthYear:function(e,t){$("div.c-events").empty(),CreateNoSelectedDateHTML(),AutomaticConfigPicker()},dateFormat:"dd/MM/yyyy",onSelect:function(e){ConfigDatePicker(_myProjects)}}),GetAllDatesByProjects(_myProjects),$(document).on("click",_dtp,(function(e){e.preventDefault(),ChangeSizeDay(),ConfigDatePicker(_myProjects)})),$(window).on("resize",(function(){ChangeSizeDay()})),ChangeSizeDay(),$(_dtp).on("click","tbody td a",(function(e){e.preventDefault();var t=$(this).prop("class").split(" ")[0];if(-1!=t.indexOf("dp")){var n=parseInt(t.substring(2)),a=new Date(n);$(_dtp+" table tbody a").not(this).each((function(e,t){$(t).removeClass("current-date-select")})),$(this).toggleClass("current-date-select"),CreateEventsInnerHTML(),$("div.c-date-selected").find("p").html(GetDateInTextFormatPE(a)),ShowListEventsByDaySelected(a),ClearEvents(),CreateNoSelectedDateHTML()}else console.log("tbody td a.datepick-selected | event:click() | No se encontró la clase dp##########")}));